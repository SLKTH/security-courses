\documentclass[Screen16to9,17pt]{foils}
\usepackage{zencurity-slides}

\externaldocument{kea-pentest-exercises}
\externaldocument{../nmap-workshop/nmap-workshop-exercises}
\selectlanguage{english}

%VF 3 Netværkspenetrationstest (5 ECTS)
% Indhold
%Den studerende lærer om hvordan en penetration test udføres, samt kan indhente oplysninger om de seneste sårbarheder, og kan benytte sig af de relevante værktøjer til dette formål.
%Viden
%Den studerende viden om og forståelse for:
%* Etiske samt kontraktuelle forhold omkring en penetrationstest.
%* Standardiseringorganisationers og myndigheders krav til og om penetrationstesting
%Færdigheder
%Den studerende kan:
%Tage højde for sikkerhedsaspekter ved at:
%* Anvende relevante metoder ved udførsel af en penetrationstest
%* Udarbejde en angrebsplan ud fra indsamlede oplysninger om et mål
%* Finde sårbarheder i et givet system
% * Dokumentere og rapportere fundne sårbarheder
% Kompetencer
%Den studerende kan:
% * Planlægge en penetration test, samt eksekvere den både ved brug af værktøjer og manuelt.


\begin{document}

\mytitlepage
{4. Network Attacks and Advanced Vulnerabilities}
{KEA Kompetence Penetration Testing}




\slide{Plan for today}

\begin{list1}
\item Subjects
\begin{list2}
\item Network Attacks
\item Nmap Workshop materials
\item Detecting network attacks
\item Talk about advanced Vulnerabilities

\end{list2}
\item Exercises
\begin{list2}
\item From the book mostly, and only Linux - on our Debian
\item Install and prepare OWASP JuiceShop
\end{list2}
\end{list2}
\end{list1}


\slide{Reading Summary}


\begin{list2}
\item Grayhat chapters 12: Advanced Linux Exploits
\item Grayhat chapters 13: Windows Exploits
\item Grayhat chapters 14: Advanced Windows Exploits -- not today!
\end{list2}

Reading Related resources:
\begin{list2}
\item \emph{Return-Oriented Programming:Systems, Languages, and Applications}
\item \emph{Removing ROP Gadgets from OpenBSD}
\end{list2}




\slide{Goals for today}
.
%{\hlkbig En 3 dages workshop, hvor du lærer at angribe dit netværk!}
\hlkrightimage{7cm}{openbsd-logo.png}

\begin{list1}
\item Take a slow day
\item Talk and explain in detail buffer overflows, and some of the parts
\item Go through examples from the book
\item Reproduce the parts we can
\item Redo buffer overflow on ARM, Raspberry Pi -- talk about shell code for systems
\item Go through the OpenBSD papers and see how one operating system has decided to handle this
\end{list1}


\slide{Hacking is magic}

\hlkimage{5cm}{wizard_in_blue_hat.png}

\vskip 1 cm

\centerline{Hacking looks like magic -- especially buffer overflows}


\slide{Hacking is not magic}

\hlkimage{14cm}{ninjas.png}

\centerline{Hacking only demands ninja training and knowledge others don't have}

It is like a puzzle, we need this, this and that. Make it happen in a repeatable way.



\slide{Nmap Workshop}

\begin{list2}
\item Portscanning with Nmap is a critical task for any pentest
\item We will now switch to the materials found in my Nmap Workshop and perform some Nmap scans\\
\url{https://github.com/kramse/security-courses/tree/master/courses/pentest/nmap-workshop}
\item We will NOT do all the exercises
\item But make sure you do the ones named on the following pages
\item Nmap can output in XML and can be converted easily into HTML
\item Nmap output can also be easily imported into a database, example Metasploit database
\item Nmap, and other active tools procuce network traffic which can often be captured and analyzed, so we will also reference a few example capture tools
\end{list2}

After we mention Metasploit - we can talk about features within this framework \smiley

\exercise{ex:nmap-pingsweep}

\exercise{ex:nmap-synscan}

\exercise{ex:nmap-os}

\exercise{ex:nmap-service}

\exercise{ex:nmap-strategy}

\exercise{ex:nmap-html}

\exercise{ex:nmap-nse}



\slide{Chaosreader}

\hlkimage{20cm}{chaosreader2.png}
\begin{list1}
\item Simple but illustrative program
\item Read a pcap - packet capture into this tool chaosreader
\item Output HTML with nice index - usefull for quick demos
\item \link{http://chaosreader.sourceforge.net/}

\end{list1}

\slide{Big data example Moloch}

\hlkimage{12cm}{moloch-sessions.png}

Picture from \link{https://github.com/aol/moloch}\\
Be your own GCHQ ... capture all, index all, search all


\exercise{ex:zeekweb}

\slide{Demo: Metasploit Armitage }

\hlkimage{12cm}{armitage-overview.png}

\exercise{ex:dbnmap}


% Part 2

\slide{Exploit components}

\begin{list1}
\item We will dive into the book: Grayhat chapters 12-14
\item We need to understand the parts of exploiting
\item Difference between the oldest, most simple stack based overflows
\item The parts of a shell code running system calls
\item How to avoid having shell code - return into libc, calling functions
\item This will teach us why modern operating systems have multiple methods designed to remove each case of exploiting
\item Allow us to understand the next subject, Return-Oriented Programming (ROP)
\end{list1}


\slide{Exploit techniques -- quick overview}

Buffer Overflow Exploits -- the quick overview:
\begin{list1}
\item Stack Based Buffer overflow -- like a machine gun.
\begin{list2}
\item Shooting lots of data into buffer, overflowing data structures
\item Simple to execute
\item Often the return address is POPed from the stack when returning from functions
\item Goal: overwrite return address, control EIP Extended Instruction Pointer
\item Control EIP -- control program execution
\end{list2}
\item Useful for generic exploiting of programs
\end{list1}

\slide{Exploit techniques -- quick overview}

\begin{list1}
\item Format string -- reading data like a microscope
\begin{list2}
\item Abusing printf format strings to read some data
\item Goal: read specific data
\end{list2}
\item Useful to reveal something secret, a key, a stack canary
\end{list1}

\slide{Exploit techniques -- quick overview}

\begin{list1}
\item Format string -- writing data like a sniper
\begin{list2}
\item Abusing printf format strings to {\bf write} some data
\item Goal: write specific data
\end{list2}
\item Useful to overwrite something specific, when generic overflowing is not allowed/can be defended
\item Overwrite a stack canary or a return address
\item End goal: execution of code
\end{list1}




\slide{Exploit techniques -- quick overview}

\begin{list1}
\item Exception Handlers -- breaking apart from the program
\begin{list2}
\item Abusing exception handling to execute code we control
\item Goal: execute code
\end{list2}
\item Example usage
\emph{Defeating the Stack Based Buffer Overflow Prevention Mechanism of Microsoft Windows 2003 Server } by David Litchfield (david@ngssoftware.com), 8 th September 2003
\end{list1}


\slide{Exploit techniques -- quick overview}

\begin{list1}
\item Return to libc -- execute function not code like importing a standard library
\begin{list2}
\item Avoid non-executable memory protection, by putting parameters on the stack not code, and then calling a function
\item Goal: execute shell code, without code
\end{list2}
\item Useful when basic stack protection is in place
\item Came before Return-Oriented Programming (ROP), but has similarities
\end{list1}



\slide{Return-Oriented Programming (ROP)}

\begin{list1}
\item We will no look into Return-Oriented Programming (ROP) hopefully prepared by the chapters for today, and exercises
\item \emph{Return-Oriented Programming:Systems, Languages, and Applications}
Ryan Roemer, Erik Buchanan, Hovav Shacam and Stefan Savage University of California, San Diego\\
\link{https://hovav.net/ucsd/dist/rop.pdf}
\item Them we will look into how a security oriented operating system has decided to prevent this method:
\item \emph{Removing ROP Gadgets from OpenBSD}
Todd Mortimer\\
\link{https://www.openbsd.org/papers/asiabsdcon2019-rop-paper.pdf}
\end{list1}

\slide{Setup the OWASP Juice Shop}

\begin{list1}
\item If we have too much time, we will look into running the OWASP Juice Shop
\item This is an application which is modern AND designed to have security flaws.
\item Read more about this project at:
\link{https://www2.owasp.org/www-project-juice-shop/} and \link{https://github.com/bkimminich/juice-shop}
\item It is recommended to buy the Pwning OWASP Juice Shop Official companion guide to the OWASP Juice Shop from https://leanpub.com/juice-shop - suggested price USD 5.99. Alternatively read online at https://pwning.owasp-juice.shop/
\item Sometimes the best method is running the Docker version
\end{list1}

\vskip 1cm
\centerline{\large Later we will start hacking this awesome application}

\exercise{ex:sw-startjuice}


\exercise{ex:js-burp}

\slidenext{}

\end{document}
